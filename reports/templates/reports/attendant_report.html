{% extends "reports/print_base.html" %}

{% block title %}Reporte de asistencia{% endblock title %}

{% block extrahead %}
{{ block.super }}
<script>
// Toggle table rows marked as "paid"
(function($) {
    $(document).ready(function() {
        var toggle = $("#paid-toggle");
        var first = true;
        toggle.click(function() {
            if (first) {
                $(".paid").closest("tr").hide();
                first = false;
            } else {
                $(".paid").closest("tr").toggle();
            }
        });
    });
})(grp.jQuery);
</script>
{% endblock extrahead %}

{% block breadcrumbs %}
<ul>
    <li><a href="{% url 'admin:index' %}">Inicio</a></li>
    <li><a href="">Reportes</a></li>
    <li>Reporte de asistencia</li>
</ul>
{% endblock %}

{% block pretitle %}
<ul class="grp-messagelist">
    <li class="grp-info">Fecha y hora de generación del reporte: {% now "DATETIME_FORMAT" %}</li>
</ul>
{% endblock %}

{% block page-tools %}
<ul>
    <li><a id="paid-toggle" href="#">Mostrar solo campistas con pagos pendientes</a></li>
</ul>
{% endblock %}

{% block content_title %}
<h1>Integrantes de ágapes ({{total}})</h1>
{% endblock %}

{% block content %}
<div class="g-d-c">
{% for small_group in small_groups %}
    {% ifchanged small_group.generation %}
    {% if not forloop.first %}
    </div>
    {% endif %}
    <div class="grp-module g-d-12 grp-collapse grp-closed">
        <h2 class="grp-collapse-handler">
            {{small_group.get_generation_display}}
        </h2>
    {% endifchanged %}
        {% with small_group.get_attendants as attendants %}
        <div class="grp-module g-d-12 grp-collapse grp-closed no-break">
            <h3 class="grp-collapse-handler">
                {{small_group}} ({{attendants|length}})
            </h3>
            <table class="big grp-full-width">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Gafete</th>
                        <th>Debe</th>
                    </tr>
                </thead>
                <tbody>
                    {% for attendant in attendants %}
                    <tr>
                        <th>{{attendant}}</th>
                        <td>{{attendant.badge_name}}</td>
                        {% with attendant.amount_due as due %}
                            {% if due > 0 %}
                            <td>${{due}}</td>
                            {% else %}
                            <td class="paid">--</td>
                            {% endif %}
                        {% endwith %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endwith %}
{% endfor %}
    </div>
</div>

<h1>Invitados ({{guests|length}})</h1>
<div class="g-d-c">
    <div class="grp-module g-d-12 grp-collapse">
        <table class="big grp-full-width">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Gafete</th>
                    <th>Debe</th>
                </tr>
            </thead>
            <tbody>
                {% for guest in guests %}
                <tr>
                    <th>{{guest}}</th>
                    <td>{{guest.badge_name}}</td>
                    {% with guest.amount_due as due %}
                        {% if due > 0 %}
                        <td>${{due}}</td>
                        {% else %}
                        <td class="paid">--</td>
                        {% endif %}
                    {% endwith %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock content %}
